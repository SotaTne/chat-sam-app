networks:
  chat-sam-app-net:
    driver: bridge

services:
  dynamodb-local:
    image: amazon/dynamodb-local:latest
    container_name: dynamodb-local
    command: "-jar DynamoDBLocal.jar -sharedDb -dbPath ./data"
    ports:
      - "8000:8000"
    volumes:
      - "./docker/dynamodb:/home/dynamodblocal/data"
    working_dir: /home/dynamodblocal
    networks:
      - chat-sam-app-net

  add-table:
    image: amazon/aws-cli
    depends_on:
      - dynamodb-local
    entrypoint: ["/bin/sh", "/tmp/init-tables.sh"]
    environment:
      - AWS_ACCESS_KEY_ID=dummy
      - AWS_SECRET_ACCESS_KEY=dummy
    volumes:
      - "./docker/MessageTable.json:/tmp/MessageTable.json"
      - "./docker/SessionTable.json:/tmp/SessionTable.json"
      - "./docker/MessageCounterTable.json:/tmp/MessageCounterTable.json"
      - "./docker/CounterRangeTable.json:/tmp/CounterRangeTable.json"
      - "./docker/init-tables.sh:/tmp/init-tables.sh"
    networks:
      - chat-sam-app-net
